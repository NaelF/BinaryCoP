# Bitpacking XNOR Operations on DSP48
BNNs reduce the complexity of most arithmetic computations in neural networks down to single-bit logic operations. These can efficiently be executed on FPGA LUTs.
However, as an alternative, the multitude of XNOR operations can also be packed into wide signals and passed through DSP blocks.

For more on the details of how this is done, please refer to the documentation in "BinaryCoP/docs/XOU2021_BinaryCoP.pdf", Sec. III.C.

The figure below shows A and B signals concatenated inside the DSP and bypassing the Multipler. The two 48-bit wide signals **A:B** and **C** (BLUE) are XNOR-ed by setting OPMODE and ALUMODE (RED) signals. Operation is also possible on DSP48E1, DSP48E2 and the latest DSP58.

<img src="/docs/imgs/DSPBitpack.png" width="600">

## Rewire FINN MVTUs
For certain FINN designs on heavily constrained FPGAs (e.g. Z7010), which only have a few thousands of LUTs, large MVTUs quickly lead to synthesis challenges. In most FINN designs, DSP blocks are mostly unused, leaving them as good candidates to execute the XNOR operations.

* Find the HLS-generated HDL files after the HLS design step of FINN (e.g. hls-syn/cnvW1A1-pynqZ1-Z2/sol1/impl/ip/hdl/vhdl/)
* Add the provided **DSP48E1_MOD.vhd** to the HDL resources
* Run the rewiring script **DSP_BitPackXNOR.py** on all MVTUs which you would like to rewire (e.g. Matrix_Vector_Activa_X.vhd).
* Replace the MVTUs of the HLS-output with the ones generated by the rewiring script
* Resynthesize the HLS IP-block with the new DSP-based MVTUs

**Note:** Only tested and verified on previous FINN repository (https://github.com/Xilinx/BNN-PYNQ)
